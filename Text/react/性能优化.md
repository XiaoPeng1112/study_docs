# 性能优化

>React DevTools Profiler、Chrome DevTools Performance Tab

1. 用过哪些工具来定位 React 应用的性能瓶颈？
    - React DevTools Profiler（专注于组件）
        - 首选用于React组件渲染性能、重渲染问题。
        - 使用步骤：
            - 启动、停止 Profiler记录。
            - 解读火焰图和排行榜（会给出哪个部分耗时多）
            - 识别并分析导致性能问题的组件
            - （可选）优化前后对比
    - Chrome DevTools Performance Tab（整个Web应用的性能）
        - 复杂场景、非React相关的JS瓶颈、布局/绘制问题、宏观性能分析。

    - Lighthouse
        - 是什么：Google提供的自动化网站质量审计工具（性能、PWA、SEO等）。
        - 为什么用：提供高阶性能指标（FCP、LCP、TBT、CLS）和优化建议。

2. 性能优化的具体手段有哪些？
    - React.memo (浅比较)等价于类组件的 PureComponent
        - 如果需要深层比较，自定义比较逻辑，memo接收第二个参数（函数）
        ```
        const MemoizeUserInfo = memo(userInfo, (prevProps, nextProps) => {
            // 如果props相等返回true，不重新渲染
            // 如果props不等返回false，重新渲染
            return prevProps.name === nextProps.name &&  prevProps.age === nextProps.age
        })
        ```
    - useCallback：记忆化回调函数，稳定函数引用。
    - useMemo：记忆化计算结果，避免重复昂贵计算。
    - 虚拟化（Windowing）：用于渲染长列表，第三方库react-window，react-virtualized，计算并仅渲染可见区域的Item。
    - 优化初始包体积，加快首屏速度：
        - React.lazy()：动态导入组件。
        - Suspense组件：处理懒加载组件的加载状态。

3. 虚拟列表
    - 长列表虚拟瓶颈主要源于**过多的DOM节点**和**React协调成本**
    - 虚拟列表通过只渲染可见区域内容来解决问题
    - 核心机制：视口计算、动态渲染、绝对定位
    - 推荐使用成熟库，如 react-window来简化开发。

4. 如果列表项的高度上动态不固定的，虚拟列表如何处理？
    - react-virtualized的CellMeasurer可以用来动态测量和缓存行高。
    - 也可能需要预估高度，渲染后获取真实高度再调整。

5. 虚拟列表有什么潜在的缺点或使用场景的限制？
    - 手写实现相对复杂
    - 对于高度动态差异巨大的项，性能优化可能不太明显，计算成本大。

6. React怎么实现代码分割的？
    - React实现：React.lazy()和Suspense
    - React.lazy(loadFunction)：
        - 一个函数，允许定义一个动态加载的组件。
        - loadFunction必须调用一个动态 import()。
        - 必须返回一个 Promise，该Promise解析为一个带有default导出的模块（即export default MyComponent）。
    - <Suspense fallback={...}>：
        - 配合React.lazy()使用，用于懒加载组件在渲染期间显示一个加载指示器（fallback UI）。
        - fallback prop 可以是任何有效的 React 元素。

7. React 项目优化：
    - React.memo、useMemo/useCallback、防抖节流、lazy load、虚拟列表、
    - 首屏优化：
        - 首屏优化核心目标是让用户尽快看到内容。通常我会做：骨架屏占位、资源按需加载、关键 CSS 和 JS 优化、首屏接口优先加载。项目里我结合 React.lazy + Suspense + 骨架屏 + CDN 加速，让首页打开速度快了 30%+，用户体验明显提升。”